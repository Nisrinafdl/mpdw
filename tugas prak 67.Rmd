---
title: "Tugas 6&7 MPDW"
author: "Nisrina Suci Fadila (G1401231021)"
date: "2025-10-08"
output: html_document
---

```{r}
library(ggplot2)
library(tsibble)
library(tseries)
library(MASS)
library(forecast)
library(TSA)
library(TTR)
library(aTSA)
library(graphics)
```

```{r}
library(rio)
data <- import("https://raw.githubusercontent.com/Nisrinafdl/mpdw/refs/heads/main/Pertemuan%201/data%20200.csv")
data
```

```{r}
data.ts <- ts(data$Revenue)
```

```{r}
data.train <- data.ts[1:160] 
data.test <- data.ts[161:200]
```

### Eksplorasi Data

#### Plot Data Penuh

```{r}
plot.ts(data.ts, lty=1, xlab="waktu", ylab="Revenue", main="Plot Saham AI")
mean(data.ts)
```
Berdasarkan plot data deret waktu di atas, terlihat data cenderung stasioner dalam rataan dan ragam. Data stasioner dalam rataan karena menyebar/bergerak di sekitar nilai tengahnya (107.488) dan dikatakan stasioner dalam ragam karena memiliki lebar pita yang cenderung sama. 

#### Plot Data Latih

```{r}
data.train <- data.ts[1:160] 
train.ts<-ts(data.train)
plot.ts(train.ts, lty=1, xlab="waktu", ylab="Revenue", main="Plot Saham AI")
mean(data.train)
```
Berdasarkan plot di atas, terlihat data cenderung stasioner dalam rataan dan ragam. Data stasioner dalam rataan karena menyebar/bergerak di sekitar nilai tengahnya (107.5251) dan dikatakan stasioner dalam ragam karena memiliki lebar pita yang cenderung sama. 


#### Plot Data Uji

```{r}
data.test <- data.ts[161:200]
test.ts<-ts(data.test)
plot.ts(test.ts, lty=1, xlab="waktu", ylab="Revenue", main="Plot Saham AI")
mean(data.test)
```
Berdasarkan plot di atas, terlihat data cenderung stasioner dalam rataan dan ragam. Data stasioner dalam rataan karena menyebar/bergerak di sekitar nilai tengahnya (107.3395) dan dikatakan stasioner dalam ragam karena memiliki lebar pita yang cenderung sama. 


### Uji Stasioneritas Data

#### Plot ACF

```{r}
acf(train.ts)
```

#### Uji ADF

```{r}
tseries::adf.test(train.ts)
```
$H_0$ : Data tidak stasioner dalam rataan

$H_1$ : Data stasioner dalam rataan

Berdasarkan uji ADF tersebut, didapat *p-value* sebesar 0.01 yang lebih kecil dari taraf nyata 5% sehingga tolak $H_0$ dan menandakan bahwa data stasioner dalam rataan. Hal ini sesuai dengan hasil eksplorasi menggunakan plot time series dan plot ACF.

#### Plot Box-Cox

```{r}
index <- seq(1:160)
bc = MASS::boxcox(train.ts~index, lambda = seq(-40,30,by=1))
#Nilai Rounded Lambda
lambda <- bc$x[which.max(bc$y)]
lambda
#SK
bc$x[bc$y > max(bc$y) - 1/2 * qchisq(.95,1)]
```

Plot Boxcox menunjukkan nilai *rounded value* ($\lambda$) optimum sebesar **-4.646** dan pada selang kepercayaan 95% nilai memiliki batas bawah **-35.757** dan batas atas **27.172**. Selang tersebut memuat nilai satu sehingga dapat dikatakan bahwa data stasioner dalam ragam.

### Identifikasi Model

#### Plot ACF

```{r}
acf(train.ts)
```

#### Plot PACF

```{r}
pacf(train.ts)
```

#### Plot EACF

```{r}
eacf(train.ts)
```

Identifikasi model menggunakan plot EACF dilakukan dengan melihat ujung segitiga pada pola segitiga nol. Dalam hal ini model tentatif yang terbentuk adalah ARIMA(0,0,1), ARIMA(1,0,1), dan ARIMA(2,0,1).

### Pendugaan Parameter Model Tentatif

#### ARIMA(4,0,3)

```{r}
model1.da=Arima(train.ts, order=c(4,0,3),method="ML")
summary(model1.da) #219.85
lmtest::coeftest(model1.da) #terdapat parameter tidak signifikan
```

#### ARIMA(1,0,1)

```{r}
model2.da=Arima(train.ts, order=c(1,0,1),method="ML")
summary(model2.da) #AIC=216.13
lmtest::coeftest(model2.da) #seluruh parameter signifikan
```

#### ARIMA(2,0,1)

```{r}
model3.da=Arima(train.ts, order=c(2,0,1),method="ML")
summary(model3.da) #AIC=218.92
lmtest::coeftest(model3.da) #tidak ada parameter signifikan
```

#### ARIMA(1,0,2)

```{r}
model4.da=Arima(train.ts, order=c(1,0,2),method="ML")
summary(model4.da) #AIC=218.88 
lmtest::coeftest(model4.da) #terdapat parameter tidak signifikan
```
Berdasarkan hasil analisis terhadap beberapa model ARIMA yang diujikan, yaitu ARIMA(4,0,3), ARIMA(1,0,1), ARIMA(2,0,1), dan ARIMA(1,0,2), diperoleh bahwa model ARIMA(1,0,1) merupakan model yang paling layak dipilih. Karena nilai AIC model ini (216.13) yang paling kecil dan seluruh parameter dalam model ARIMA(1,0,1) terbukti signifikan secara statistik dengan nilai p < 0.05. Selain itu, nilai kesalahan seperti RMSE, MAE, dan MAPE menunjukkan hasil yang cukup kecil dan stabil, menandakan kemampuan model yang baik dalam menggambarkan pola data.

### Analisis Sisaan

Model terbaik hasil identifikasi kemudian dicek asumsi sisaannya. Sisaan model ARIMA harus memenuhi asumsi normalitas, kebebasan sisaan, dan kehomogenan ragam. Diagnostik model dilakukan secara eksplorasi dan uji formal.

#### Eksplorasi Sisaan

```{r}
#Eksplorasi 
sisaan.da <- model2.da$residuals 
par(mfrow=c(2,2)) 
qqnorm(sisaan.da) 
qqline(sisaan.da, col = "blue", lwd = 2) 
plot(c(1:length(sisaan.da)),sisaan.da) 
acf(sisaan.da) 
pacf(sisaan.da) 
par(mfrow = c(1,1))
```
Berdasarkan plot kuantil-kuantil normal, menunjukkan bahwa titik-titik residual tidak mengikuti garis diagonal, yang berarti sisaan tidak berdistribusi normal. Plot sebaran sisaan terhadap waktu menunjukkan bahwa titik-titik sisaan tersebar acak di sekitar nol tanpa pola tertentu dan memiliki lebar pita yang relatif sama, menandakan bahwa ragam sisaan bersifat homogen. Selain itu, plot ACF dan PACF sisaan model ARIMA(1,0,1) menunjukkan bahwa tidak ada lag yang signifikan pada 20 lag pertama, sehingga dapat dikatakan bahwa sisaan saling bebas (tidak berkorelasi). Kondisi ini menunjukkan bahwa model ARIMA(1,0,1) telah memenuhi asumsi dasar model deret waktu, namun tetap perlu diuji lebih lanjut melalui uji formal.

#### Uji Formal

```{r}
#1) Sisaan Menyebar Normal 
ks.test(sisaan.da,"pnorm")  #tak tolak H0 > sisaan menyebar normal
```

Selain dengan eksplorasi, asumsi tersebut dapat diuji menggunakan uji formal. Pada tahapan ini uji formal yang digunakan untuk normalitas adalah uji Kolmogorov-Smirnov (KS). Hipotesis pada uji KS adalah sebagai berikut.

$H_0$ : Sisaan menyebar normal

$H_1$ : Sisaan tidak menyebar normal

Berdasarkan uji KS tersebut, didapat *p-value* sebesar 0.000008 yang kurang dari taraf nyata 5% sehingga tolak $H_0$ dan menandakan bahwa sisaan tidak menyebar normal. Hal ini sesuai dengan hasil eksplorasi menggunakan plot kuantil-kuantil normal.

```{r}
#2) Sisaan saling bebas/tidak ada autokorelasi 
Box.test(sisaan.da, type = "Ljung")  #tak tolak H0 > sisaan saling bebas
```

Selanjutnya akan dilakukan uji formal untuk kebebasan sisaan menggunakan uji Ljung-Box. Hipotesis yang digunakan adalah sebagai berikut.

$H_0$ : Sisaan saling bebas

$H_1$ : Sisaan tidak tidak saling bebas

Berdasarkan uji Ljung-Box tersebut, didapat *p-value* sebesar 0.984 yang lebih besar dari taraf nyata 5% sehingga tak tolak $H_0$ dan menandakan bahwa sisaan saling bebas. Hal ini berbeda dengan eksplorasi.

```{r}
#3) Sisaan homogen 
Box.test((sisaan.da)^2, type = "Ljung")  #tak tolak H0 > sisaan homogen
```

Hipotesis yang digunakan untuk uji kehomogenan ragam adalah sebagai berikut.

$H_0$ : Ragam sisaan homogen

$H_1$ : Ragam sisaan tidak homogen

Berdasarkan uji Ljung-Box terhadap sisaan kuadrat tersebut, didapat *p-value* sebesar 0.2585 yang lebih dari taraf nyata 5% sehingga tak tolak $H_0$ dan menandakan bahwa ragam sisaan homogen.

```{r}
#4) Nilai tengah sisaan sama dengan nol 
t.test(sisaan.da, mu = 0, conf.level = 0.95)  #tak tolak h0 > nilai tengah sisaan sama dengan 0
```

Terakhir, dengan uji-t, akan dicek apakah nilai tengah sisaan sama dengan nol. Hipotesis yang diujikan sebagai berikut.

$H_0$ : nilai tengah sisaan sama dengan 0

$H_1$ : nilai tengah sisaan tidak sama dengan 0

Berdasarkan uji-ttersebut, didapat *p-value* sebesar  0.9716 yang lebih besar dari taraf nyata 5% sehingga tak tolak $H_0$ dan menandakan bahwa nilai tengah sisaan sama dengan nol. Hal ini berbeda dengan eksplorasi.

### Overfitting

Karena model hasil overfitting sudah termasuk di dalam model tentatif dan hasilnya tidak lebih baik, maka model terbaik yang dipilih adalah ARIMA(0,1,1) dilanjutkan dengan peramalan.

```{r}
model5.da=Arima(train.ts, order=c(1,0,2),method="ML")
summary(model5.da) #AIC=218.88 
lmtest::coeftest(model5.da) #terdapat parameter tidak signifikan
```
Karena model hasil overfitting hasilnya tidak lebih baik, maka model terbaik yang dipilih adalah ARIMA(1,0,1) dilanjutkan dengan peramalan.

### Peramalan

Peramalan dilakukan menggunakan fungsi `forecast()` . Contoh peramalan berikut ini dilakukan untuk 30 hari ke depan.

```{r}
#---FORECAST---#
ramalan.da <- forecast::forecast(model2.da, h = 31) 
ramalan.da
data.ramalan.da <- ramalan.da$mean
plot(ramalan.da)
```
Berdasarkan hasil plot ramalan di atas, dapat dilihat bahwa ramalan ARIMA(1,0,1) cenderung stabil hingga akhir periode.

```{r}
pt_1 <- train.ts[160] #nilai akhir data latih
hasil.forc.Diff <- data.ramalan.da

# Plot data aktual dan hasil peramalan
ts.plot(train.ts, hasil, col = c("black", "red"), lty = 1:2)
legend("topleft", legend = c("Data Aktual", "Hasil Peramalan"),
       col = c("black", "red"), lty = 1:2, bty = "n")
```
Grafik menunjukkan bahwa hasil peramalan mengikuti pola data aktual dengan baik. Nilai ramalan tampak stabil di sekitar 107,5, menandakan bahwa model ARIMA(1,0,1) mampu memberikan prediksi yang akurat dan konsisten terhadap pola data sebelumnya.

```{r}
perbandingan<-matrix(data=c(head(test.ts, n=30), hasil[-1]),
                     nrow = 30, ncol = 2)
colnames(perbandingan)<-c("Aktual","Hasil Forecast")
perbandingan
accuracy(ts(hasil[-1]), head(test.ts, n=30))
```
Hasil peramalan menggunakan model ARIMA(1,0,1) menunjukkan bahwa nilai prediksi sangat mendekati nilai aktual. Nilai MAPE sebesar 0.42% menandakan tingkat kesalahan yang sangat kecil, sedangkan ME negatif menunjukkan model sedikit melebihkan hasil prediksi. Nilai ACF1 yang rendah dan Theilâ€™s U sebesar 0.77 < 1 menunjukkan bahwa residual bersifat acak dan model lebih baik. Secara keseluruhan, model ARIMA(1,0,1) memiliki kinerja yang baik dan akurat dalam memprediksi data.